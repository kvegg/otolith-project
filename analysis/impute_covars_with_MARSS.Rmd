---
title: "Imputation of missing covariates"
output:
  html_document:
    theme: cerulean
    toc: true
    toc_float: true
    toc_depth: 3
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br/>

[__Mark Scheuerell__](https://faculty.washington.edu/scheuerl/)  
_Fish Ecology Division, Northwest Fisheries Science Center, National Marine Fisheries Service, National Oceanic and Atmospheric Administration, Seattle, WA, USA_

__Karl Veggerby__  
_Ocean Associates, Seattle, WA, USA_

***

This is version `r paste0('0.',format(Sys.time(), '%y.%m.%d'))`.

***

# Background


# Requirements

```{r load_pkgs, message=FALSE}
## for analysis
library(MARSS)
## for dir mgmt
library(here)
datadir <- here("data")
```

# Data munging

We begin by loading the data file with the temperature summaries by time (rows) and location (cols).

```{r load_covars}
## load obs covariates
cobs <- read.csv(file.path(datadir, "daily_mean_temp.csv"),
                 stringsAsFactors = FALSE)
## inspect data
head(cobs)
```

Let's simplify some names in the file and round the observations to the nearest 0.01.

```{r change_colnames}
## simplify colnames
colnames(cobs) <- gsub("data_source", replacement = "s", x = colnames(cobs))
colnames(cobs) <- gsub("daily_mean", replacement = "T", x = colnames(cobs))
## site abbrevs
sites <- gsub("T_", replacement = "", x = colnames(cobs)[10:16])
## simplify sources
cobs[cobs=="team carcass"] <- "car"
cobs[cobs=="achord_gordy"] <- "tag"
## round temps
cobs[,grep("T_", colnames(cobs))] <- round(cobs[,grep("T_", colnames(cobs))], 2)
## inspect
head(cobs)
tail(cobs)
```

The temperature data come from two different sources: 1) the food web group (Sanderson et al.), and 2) the juvenile tagging group (Achord, Axel et al.). We need to split the data out by those groups.

```{r split_obs_grps}
## empty data frames
car <- tag <- matrix(NA, nrow(cobs), length(sites),
                     dimnames = list(NULL, sites))
## measurements
vals <- cobs[,-(1:9)]
## indices of data type
i_car <- cobs[,3:9] == "car"
i_tag <- cobs[,3:9] == "tag"
## group-specific data
car[i_car] <- vals[i_car]
tag[i_tag] <- vals[i_tag]
## drop any sites with all NA's
car <- car[,apply(car, 2, function(x) !all(is.na(x)))]
colnames(car) <- paste0(colnames(car), "_car")
tag <- tag[,apply(tag, 2, function(x) !all(is.na(x)))]
colnames(tag) <- paste0(colnames(tag), "_tag")
## regroup by sites & source
cobs_m <- cbind(car, tag)
cobs_m <- cobs_m[,sort(colnames(cobs_m))]
head(cobs_m)
matplot(cobs_m, type="l", lty="solid")
```

